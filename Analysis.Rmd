---
title: "Analysis"
output: pdf_document
date: "2024-11-30"
---

```{r, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, error = TRUE)
library(ggplot2)
library(car)
library(MASS)
library(dplyr)
```

```{r}
data <- read.csv("pandemic_data.csv")
head(data)
summary(data) # load is i+q



# Anova
anova_model <- aov(load ~ soc.iso * rate.vac * quar.dur * num.daily, data = data)
summary(anova_model)



# Regression and Box-Cox
lm_model <- lm(load ~ soc.iso * rate.vac * quar.dur * num.daily, data = data)
summary(lm_model)
confint(lm_model, level = 0.95)

# Box-Cox Transformation
boxcox_result <- boxcox(lm_model, lambda = seq(-2, 2, by = 0.1))
optimal_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
optimal_lambda # no transformation



# Residual plots
residuals_plot <- ggplot(data.frame(fitted = lm_model$fitted.values, 
                                    residuals = lm_model$residuals), 
                         aes(x = fitted, y = residuals)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(title = "Residuals vs Fitted Values", x = "Fitted Values", y = "Residuals")
print(residuals_plot)
# Q-Q Plot
qqnorm(lm_model$residuals, main = "Normal Q-Q Plot")
qqline(lm_model$residuals)



# Graphics
# Interaction plots
interaction.plot(
  x.factor = data$soc.iso,
  trace.factor = data$rate.vac,
  response = data$load,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Social Isolation x Vaccination Rate",
  xlab = "Social Isolation",
  ylab = "Peak Infected",
  trace.label = "Vaccination Rate"
)
interaction.plot(
  x.factor = data$soc.iso,
  trace.factor = data$quar.dur,
  response = data$load,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Social Isolation x Quarantine Duration",
  xlab = "Social Isolation",
  ylab = "Peak Infected",
  trace.label = "Quarantine Duration"
)
interaction.plot(
  x.factor = data$soc.iso,
  trace.factor = data$num.daily,
  response = data$load,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Social Isolation x Daily Interactions",
  xlab = "Social Isolation",
  ylab = "Peak Infected",
  trace.label = "Daily Interactions"
)
interaction.plot(
  x.factor = data$rate.vac,
  trace.factor = data$quar.dur,
  response = data$load,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Vaccination Rate x Quarantine Duration",
  xlab = "Vaccination Rate",
  ylab = "Peak Infected",
  trace.label = "Quarantine Duration"
)
interaction.plot(
  x.factor = data$rate.vac,
  trace.factor = data$num.daily,
  response = data$load,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Vaccination Rate x Daily Interactions",
  xlab = "Vaccination Rate",
  ylab = "Peak Infected",
  trace.label = "Daily Interactions"
)
interaction.plot(
  x.factor = data$quar.dur,
  trace.factor = data$num.daily,
  response = data$load,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Quarantine Duration x Daily Interactions",
  xlab = "Quarantine Duration",
  ylab = "Peak Infected",
  trace.label = "Daily Interactions"
)

# Boxplots
ggplot(data, aes(x = as.factor(soc.iso), y = load)) +
  geom_boxplot() +
  labs(title = "Effect of Social Isolation on Peak Infected", 
       x = "Social Isolation Level", y = "Peak Infected")

ggplot(data, aes(x = as.factor(rate.vac), y = load)) +
  geom_boxplot() +
  labs(title = "Effect of Vaccination Rate on Peak Infected", 
       x = "Vaccination Rate", y = "Peak Infected")

ggplot(data, aes(x = as.factor(quar.dur), y = load)) +
  geom_boxplot() +
  labs(title = "Effect of Quarantine Duration on Peak Infected",
    x = "Quarantine Duration (Days)", y = "Peak Infected")

ggplot(data, aes(x = as.factor(num.daily), y = load)) +
  geom_boxplot() +
  labs(title = "Effect of Daily Interactions on Peak Infected",
    x = "Daily Interactions", y = "Peak Infected")



# Optimal Combination
aggregated_results <- aggregate(load ~ soc.iso + rate.vac + quar.dur + num.daily, data = data, mean)
optimal_combination <- aggregated_results[which.min(aggregated_results$load), ]
optimal_combination



# Treatment Contrasts
data$soc.iso <- as.factor(data$soc.iso)
data$rate.vac <- as.factor(data$rate.vac)
data$quar.dur <- as.factor(data$quar.dur)
data$num.daily <- as.factor(data$num.daily)
head(data)

contrasts(data$soc.iso) <- contr.treatment(levels(data$soc.iso), base = 1) 
contrasts(data$rate.vac) <- contr.treatment(levels(data$rate.vac), base = 1) 
contrasts(data$quar.dur) <- contr.treatment(levels(data$quar.dur), base = 1) 
contrasts(data$num.daily) <- contr.treatment(levels(data$num.daily), base = 1) 

# Fit linear model with treatment contrasts
lm_treatment <- lm(load ~ soc.iso + rate.vac + quar.dur + num.daily, data = data)
summary(lm_treatment)

confint(lm_treatment, level = 0.95)
coef_lm <- coef(lm_treatment)
coef_lm
confint_lm <- confint(lm_treatment)
confint_lm



```
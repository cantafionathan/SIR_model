---
title: "Analysis"
output: pdf_document
date: "2024-11-30"
---

```{r, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, error = TRUE)
library(ggplot2)
library(car)
library(MASS)
library(dplyr)
```

```{r}
data <- read.csv("pandemic_data.csv")
head(data)
summary(data)
# peak.inf is i+q

# TODO need to consider the aliasing structure so that we know what tertiary effects cannot actually be estimated here and mention this in report

# TODO I wonder if our levels for vaccination rate are high enough

# TODO Treatment contrasts?

# Anova
anova_model <- aov(peak.inf ~ soc.iso * rate.vac * 
                quar.dur * num.daily, data = data)
summary(anova_model)

# Interaction plots
interaction.plot(
  x.factor = data$soc.iso,
  trace.factor = data$rate.vac,
  response = data$peak.inf,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Social Isolation x Vaccination Rate",
  xlab = "Social Isolation",
  ylab = "Peak Infected",
  trace.label = "Vaccination Rate"
)

interaction.plot(
  x.factor = data$soc.iso,
  trace.factor = data$quar.dur,
  response = data$peak.inf,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Social Isolation x Quarantine Duration",
  xlab = "Social Isolation",
  ylab = "Peak Infected",
  trace.label = "Quarantine Duration"
)

interaction.plot(
  x.factor = data$soc.iso,
  trace.factor = data$num.daily,
  response = data$peak.inf,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Social Isolation x Daily Interactions",
  xlab = "Social Isolation",
  ylab = "Peak Infected",
  trace.label = "Daily Interactions"
)

interaction.plot(
  x.factor = data$rate.vac,
  trace.factor = data$quar.dur,
  response = data$peak.inf,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Vaccination Rate x Quarantine Duration",
  xlab = "Vaccination Rate",
  ylab = "Peak Infected",
  trace.label = "Quarantine Duration"
)

interaction.plot(
  x.factor = data$rate.vac,
  trace.factor = data$num.daily,
  response = data$peak.inf,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Vaccination Rate x Daily Interactions",
  xlab = "Vaccination Rate",
  ylab = "Peak Infected",
  trace.label = "Daily Interactions"
)

interaction.plot(
  x.factor = data$quar.dur,
  trace.factor = data$num.daily,
  response = data$peak.inf,
  col = 1:4,
  lty = 1,
  main = "Interaction Plot: Quarantine Duration x Daily Interactions",
  xlab = "Quarantine Duration",
  ylab = "Peak Infected",
  trace.label = "Daily Interactions"
)




# Regression and Box-Cox
lm_model <- lm(peak.inf ~ soc.iso * rate.vac * 
                quar.dur * num.daily, data = data)
summary(lm_model)

# Box-Cox Transformation
boxcox_result <- boxcox(lm_model, lambda = seq(-2, 2, by = 0.1))
optimal_lambda <- boxcox_result$x[which.max(boxcox_result$y)]
optimal_lambda # no transformation





# Residual plots
residuals_plot <- ggplot(data.frame(fitted = lm_model$fitted.values, 
                                    residuals = lm_model$residuals), 
                         aes(x = fitted, y = residuals)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(title = "Residuals vs Fitted Values", x = "Fitted Values", y = "Residuals")
print(residuals_plot)

qqnorm(resid(lm_model))





# Bunch of other plots
ggplot(data, aes(x = as.factor(soc.iso), y = peak.inf)) +
  geom_boxplot() +
  labs(title = "Effect of Social Isolation on Peak Infected", 
       x = "Social Isolation Level", y = "Peak Infected")

ggplot(data, aes(x = as.factor(rate.vac), y = peak.inf)) +
  geom_boxplot() +
  labs(title = "Effect of Vaccination Rate on Peak Infected", 
       x = "Vaccination Rate", y = "Peak Infected")

ggplot(data, aes(x = as.factor(quar.dur), y = peak.inf)) +
  geom_boxplot() +
  labs(title = "Effect of Quarantine Duration on Peak Infected",
    x = "Quarantine Duration (Days)", y = "Peak Infected")

ggplot(data, aes(x = as.factor(num.daily), y = peak.inf)) +
  geom_boxplot() +
  labs(title = "Effect of Daily Interactions on Peak Infected",
    x = "Daily Interactions", y = "Peak Infected")

pairs(data[, c("peak.inf", "soc.iso", "rate.vac", 
               "quar.dur", "num.daily")], 
      main = "Scatterplot Matrix") #not useful

ggplot(data, aes(x = peak.inf)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribution of Peak Infected", x = "Peak Infected", y = "Count")

ggplot(data, aes(x = peak.inf, fill = as.factor(soc.iso))) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of Peak Infected by Social Isolation", 
       x = "Peak Infected", fill = "Social Isolation Level")

ggplot(data, aes(x = peak.inf, fill = as.factor(rate.vac))) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of Peak Infected by Vaccination Rate", 
       x = "Peak Infected", fill = "Vaccination Rate")

ggplot(data, aes(x = peak.inf, fill = as.factor(quar.dur))) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of Peak Infected by Quarantine Duration (Days)", 
       x = "Peak Infected", fill = "Quarantine Duration (Days)")

ggplot(data, aes(x = peak.inf, fill = as.factor(num.daily))) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of Peak Infected by Daily Interactions", 
       x = "Peak Infected", fill = "Daily Interactions")



```










